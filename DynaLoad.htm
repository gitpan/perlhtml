<HEAD><CENTER><TITLE>DynaLoader</TITLE>
</CENTER></HEAD>
<BODY><p><hr>

<H1> 
<A NAME="DynaLoader_name_0">
NAME</A>
</H1>
DynaLoader - Dynamically load C libraries into Perl code
<p>
<A HREF="DynaLoad.htm#DynaLoader_dl_error_0">dl_error()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_findfile_0">dl_findfile()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_expandspec_0">dl_expandspec()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_load_file_0">dl_load_file()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_find_symbol_0">dl_find_symbol()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_undef_symbols_0">dl_undef_symbols()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_dl_install_xsub_0">dl_install_xsub()</A>
, 
<A HREF="DynaLoad.htm#DynaLoader_boostrap_0">boostrap()</A>
 - routines used by DynaLoader modules
<p><p><hr>

<H1> 
<A NAME="DynaLoader_synopsis_0">
SYNOPSIS</A>
</H1>

<XMP>
    package YourPackage;
    require DynaLoader;
    @ISA = qw(... DynaLoader ...);
    bootstrap YourPackage;

</XMP>
<p><p><hr>

<H1> 
<A NAME="DynaLoader_description_0">
DESCRIPTION</A>
</H1>
This document defines a standard generic interface to the dynamic
linking mechanisms available on many platforms.  Its primary purpose is
to implement automatic dynamic loading of Perl modules.
<p>This document serves as both a specification for anyone wishing to
implement the DynaLoader for a new platform and as a guide for
anyone wishing to use the DynaLoader directly in an application.
<p>The DynaLoader is designed to be a very simple high-level
interface that is sufficiently general to cover the requirements
of SunOS, HP-UX, NeXT, Linux, VMS and other platforms.
<p>It is also hoped that the interface will cover the needs of OS/2, NT
etc and also allow pseudo-dynamic linking (using <CODE>ld -A</CODE> at runtime).
<p>It must be stressed that the DynaLoader, by itself, is practically
useless for accessing non-Perl libraries because it provides almost no
Perl-to-C 'glue'.  There is, for example, no mechanism for calling a C
library function or supplying arguments.  It is anticipated that any
glue that may be developed in the future will be implemented in a
separate dynamically loaded module.
<p>DynaLoader Interface Summary
<p>
<XMP>
  @dl_library_path
  @dl_resolve_using
  @dl_require_symbols
  $dl_debug
                                                  Implemented in:
  bootstrap($modulename)                               Perl
  @filepaths = dl_findfile(@names)                     Perl
  $libref  = dl_load_file($filename)                   C
  $symref  = dl_find_symbol($libref, $symbol)          C
  @symbols = dl_undef_symbols()                        C
  dl_install_xsub($name, $symref [, $filename])        C
  $message = dl_error                                  C

</XMP>
<p>
<DL>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_library_path_0">
@dl_library_path</A>

</DT></STRONG>
<DD>
The standard/default list of directories in which 
<A HREF="DynaLoad.htm#DynaLoader_dl_findfile_0">dl_findfile()</A>
 will
search for libraries etc.  Directories are searched in order:
<STRONG>$dl_library_path</STRONG>[0], [1], ... etc
<p>
<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
 is initialised to hold the list of 'normal' directories
(<EM>/usr/lib</EM>, etc) determined by <STRONG>Configure</STRONG> (<CODE><STRONG>$Config</STRONG>{'libpth'}</CODE>).  This should
ensure portability across a wide range of platforms.
<p>
<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
 should also be initialised with any other directories
that can be determined from the environment at runtime (such as
LD_LIBRARY_PATH for SunOS).
<p>After initialisation 
<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
 can be manipulated by an
application using push and unshift before calling 
<A HREF="DynaLoad.htm#DynaLoader_dl_findfile_0">dl_findfile()</A>
.
Unshift can be used to add directories to the front of the search order
either to save search time or to override libraries with the same name
in the 'normal' directories.
<p>The load function that 
<A HREF="DynaLoad.htm#DynaLoader_dl_load_file_0">dl_load_file()</A>
 calls may require an absolute
pathname.  The 
<A HREF="DynaLoad.htm#DynaLoader_dl_findfile_0">dl_findfile()</A>
 function and 
<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
 can be
used to search for and return the absolute pathname for the
library/object that you wish to load.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_resolve_using_0">
@dl_resolve_using</A>

</DT></STRONG>
<DD>
A list of additional libraries or other shared objects which can be
used to resolve any undefined symbols that might be generated by a
later call to <EM>load_file()</EM>.
<p>This is only required on some platforms which do not handle dependent
libraries automatically.  For example the Socket Perl extension library
(<EM>auto/Socket/Socket.so</EM>) contains references to many socket functions
which need to be resolved when it's loaded.  Most platforms will
automatically know where to find the 'dependent' library (e.g.,
<EM>/usr/lib/libsocket.so</EM>).  A few platforms need to to be told the location
of the dependent library explicitly.  Use 
<A HREF="DynaLoad.htm#DynaLoader_dl_resolve_using_0">@dl_resolve_using</A>
 for this.
<p>Example usage:
<p>
<XMP>
    @dl_resolve_using = dl_findfile('-lsocket');

</XMP>
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_require_symbols_0">
@dl_require_symbols</A>

</DT></STRONG>
<DD>
A list of one or more symbol names that are in the library/object file
to be dynamically loaded.  This is only required on some platforms.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_error_0">
dl_error()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    $message = dl_error();

</XMP>
<p>Error message text from the last failed DynaLoader function.  Note
that, similar to errno in unix, a successful function call does not
reset this message.
<p>Implementations should detect the error as soon as it occurs in any of
the other functions and save the corresponding message for later
retrieval.  This will avoid problems on some platforms (such as SunOS)
where the error message is very temporary (e.g., <EM>dlerror()</EM>).
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_debug_0">
$dl_debug</A>

</DT></STRONG>
<DD>
Internal debugging messages are enabled when 
<A HREF="DynaLoad.htm#DynaLoader_dl_debug_0">$dl_debug</A>
 is set true.
Currently setting 
<A HREF="DynaLoad.htm#DynaLoader_dl_debug_0">$dl_debug</A>
 only affects the Perl side of the
DynaLoader.  These messages should help an application developer to
resolve any DynaLoader usage problems.
<p>
<A HREF="DynaLoad.htm#DynaLoader_dl_debug_0">$dl_debug</A>
 is set to <CODE><STRONG>$ENV</STRONG>{'PERL_DL_DEBUG'}</CODE> if defined.
<p>For the DynaLoader developer/porter there is a similar debugging
variable added to the C code (see dlutils.c) and enabled if Perl was
built with the <STRONG>-DDEBUGGING</STRONG> flag.  This can also be set via the
PERL_DL_DEBUG environment variable.  Set to 1 for minimal information or
higher for more.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_findfile_0">
dl_findfile()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    @filepaths = dl_findfile(@names)

</XMP>
<p>Determine the full paths (including file suffix) of one or more
loadable files given their generic names and optionally one or more
directories.  Searches directories in 
<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
 by default and
returns an empty list if no files were found.
<p>Names can be specified in a variety of platform independent forms.  Any
names in the form <STRONG>-lname</STRONG> are converted into <EM>libname.*</EM>, where <EM>.*</EM> is
an appropriate suffix for the platform.
<p>If a name does not already have a suitable prefix and/or suffix then
the corresponding file will be searched for by trying combinations of
prefix and suffix appropriate to the platform: ``<STRONG>$name</STRONG>.o'', ``lib<STRONG>$name</STRONG>.*''
and ``<STRONG>$name</STRONG>''.
<p>If any directories are included in <STRONG>@names</STRONG> they are searched before

<A HREF="DynaLoad.htm#DynaLoader_dl_library_path_0">@dl_library_path</A>
.  Directories may be specified as <STRONG>-Ldir</STRONG>.  Any other
names are treated as filenames to be searched for.
<p>Using arguments of the form <CODE>-Ldir</CODE> and <CODE>-lname</CODE> is recommended.
<p>Example: 
<p>
<XMP>
    @dl_resolve_using = dl_findfile(qw(-L/usr/5lib -lposix));

</XMP>
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_expandspec_0">
dl_expandspec()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    $filepath = dl_expandspec($spec)

</XMP>
<p>Some unusual systems, such as VMS, require special filename handling in
order to deal with symbolic names for files (i.e., VMS's Logical Names).
<p>To support these systems a 
<A HREF="DynaLoad.htm#DynaLoader_dl_expandspec_0">dl_expandspec()</A>
 function can be implemented
either in the <EM>dl_*.xs</EM> file or code can be added to the autoloadable

<A HREF="DynaLoad.htm#DynaLoader_dl_expandspec_0">dl_expandspec()</A>
 function in <EM>DynaLoader.pm</EM>.  See <EM>DynaLoader.pm</EM> for
more information.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_load_file_0">
dl_load_file()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    $libref = dl_load_file($filename)

</XMP>
<p>Dynamically load <STRONG>$filename</STRONG>, which must be the path to a shared object
or library.  An opaque 'library reference' is returned as a handle for
the loaded object.  Returns undef on error.
<p>(On systems that provide a handle for the loaded object such as SunOS
and HPUX, <STRONG>$libref</STRONG> will be that handle.  On other systems <STRONG>$libref</STRONG> will
typically be <STRONG>$filename</STRONG> or a pointer to a buffer containing <STRONG>$filename</STRONG>.
The application should not examine or alter <STRONG>$libref</STRONG> in any way.)
<p>This is function that does the real work.  It should use the current
values of 
<A HREF="DynaLoad.htm#DynaLoader_dl_require_symbols_0">@dl_require_symbols</A>
 and 
<A HREF="DynaLoad.htm#DynaLoader_dl_resolve_using_0">@dl_resolve_using</A>
 if required.
<p>
<XMP>
    SunOS: dlopen($filename)
    HP-UX: shl_load($filename)
    Linux: dld_create_reference(@dl_require_symbols); dld_link($filename)
    NeXT:  rld_load($filename, @dl_resolve_using)
    VMS:   lib$find_image_symbol($filename,$dl_require_symbols[0])

</XMP>
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_find_symbol_0">
dl_find_symbol()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    $symref = dl_find_symbol($libref, $symbol)

</XMP>
<p>Return the address of the symbol <STRONG>$symbol</STRONG> or 
<A HREF="perlfunc.htm#perlfunc_undef_0">undef</A>
 if not found.  If the
target system has separate functions to search for symbols of different
types then 
<A HREF="DynaLoad.htm#DynaLoader_dl_find_symbol_0">dl_find_symbol()</A>
 should search for function symbols first and
then other types.
<p>The exact manner in which the address is returned in <STRONG>$symref</STRONG> is not
currently defined.  The only initial requirement is that <STRONG>$symref</STRONG> can
be passed to, and understood by, 
<A HREF="DynaLoad.htm#DynaLoader_dl_install_xsub_0">dl_install_xsub()</A>
.
<p>
<XMP>
    SunOS: dlsym($libref, $symbol)
    HP-UX: shl_findsym($libref, $symbol)
    Linux: dld_get_func($symbol) and/or dld_get_symbol($symbol)
    NeXT:  rld_lookup("_$symbol")
    VMS:   lib$find_image_symbol($libref,$symbol)

</XMP>
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_undef_symbols_0">
dl_undef_symbols()</A>

</DT></STRONG>
<DD>
Example
<p>
<XMP>
    @symbols = dl_undef_symbols()

</XMP>
<p>Return a list of symbol names which remain undefined after <EM>load_file()</EM>.
Returns <CODE>()</CODE> if not known.  Don't worry if your platform does not provide
a mechanism for this.  Most do not need it and hence do not provide it,
they just return an empty list.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_dl_install_xsub_0">
dl_install_xsub()</A>

</DT></STRONG>
<DD>
Syntax:
<p>
<XMP>
    dl_install_xsub($perl_name, $symref [, $filename])

</XMP>
<p>Create a new Perl external subroutine named <STRONG>$perl_name</STRONG> using <STRONG>$symref</STRONG> as
a pointer to the function which implements the routine.  This is simply
a direct call to <EM>newXSUB()</EM>.  Returns a reference to the installed
function.
<p>The <STRONG>$filename</STRONG> parameter is used by Perl to identify the source file for
the function if required by 
<A HREF="perlfunc.htm#perlfunc_die_0">die()</A>
, 
<A HREF="perlfunc.htm#perlfunc_caller_0">caller()</A>
 or the debugger.  If
<STRONG>$filename</STRONG> is not defined then ``DynaLoader'' will be used.
<p>
<DT>

<STRONG>

<A NAME="DynaLoader_boostrap_0">
boostrap()</A>

</DT></STRONG>
<DD>
Syntax:
<p>bootstrap(<STRONG>$module</STRONG>)
<p>This is the normal entry point for automatic dynamic loading in Perl.
<p>It performs the following actions:
<p>
<UL>
<LI>locates an auto/<STRONG>$module</STRONG> directory by searching 
<A HREF="perlvar.htm#perlvar_inc_0">@INC</A>

<p>
<LI>uses 
<A HREF="DynaLoad.htm#DynaLoader_dl_findfile_0">dl_findfile()</A>
 to determine the filename to load
<p>
<LI>sets 
<A HREF="DynaLoad.htm#DynaLoader_dl_require_symbols_0">@dl_require_symbols</A>
 to <CODE>(``boot_<STRONG>$module</STRONG>'')</CODE>
<p>
<LI>executes an <EM>auto/<STRONG>$module</STRONG>/<STRONG>$module</STRONG>.bs</EM> file if it exists
(typically used to add to 
<A HREF="DynaLoad.htm#DynaLoader_dl_resolve_using_0">@dl_resolve_using</A>
 any files which
are required to load the module on the current platform)
<p>
<LI>calls 
<A HREF="DynaLoad.htm#DynaLoader_dl_load_file_0">dl_load_file()</A>
 to load the file
<p>
<LI>calls 
<A HREF="DynaLoad.htm#DynaLoader_dl_undef_symbols_0">dl_undef_symbols()</A>
 and warns if any symbols are undefined
<p>
<LI>calls 
<A HREF="DynaLoad.htm#DynaLoader_dl_find_symbol_0">dl_find_symbol()</A>
 for ``boot_<STRONG>$module</STRONG>''
<p>
<LI>calls 
<A HREF="DynaLoad.htm#DynaLoader_dl_install_xsub_0">dl_install_xsub()</A>
 to install it as ``<STRONG>${</STRONG>module}::bootstrap''
<p>
<LI>calls &amp;{``<STRONG>${</STRONG>module}::bootstrap''} to bootstrap the module (actually
it uses the function reference returned by dl_install_xsub for speed)
<p>
</UL>

</UL>
<p><hr>

<H1> 
<A NAME="DynaLoader_author_0">
AUTHOR</A>
</H1>
Tim Bunce, 11 August 1994.
<p>This interface is based on the work and comments of (in no particular
order): Larry Wall, Robert Sanders, Dean Roehrich, Jeff Okamoto, Anno
Siegel, Thomas Neumann, Paul Marquess, Charles Bailey, myself and others.
<p>Larry Wall designed the elegant inherited bootstrap mechanism and
implemented the first Perl 5 dynamic loader using it.
<p>
</BODY>
</HTML>
